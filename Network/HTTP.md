### HTTP(HyperText Transfer Protocol)

- HTTP 메시지에는 html, text, json, xml, 이미지, 영상, 파일 등 다양한 데이터가 담긴다
- HTTP/1.1 버전이 가장 많이 사용되며 2, 3은 성능 개선 버전이다

### Stateful 상태 유지

- 서버가 상태를 유지하는 것으로 항상 같은 서버가 유지되어야 한다
- 중간에 서버 장애가 나게되면 클라이언트는 새 서버에 새로 요청을 해야한다

### Stateless 무상태

- HTTP는 무상태 프로토콜이다
- 요청 메시지에 필요 데이터를 담아서 보냄으로 어떤 서버든 요청할 수 있다
- 갑자기 클라이언트 요청이 증가해도 서버를 대거 투입할 수 있다 (수평 확장에 유리)
- 클라이언트와 서버가 요청과 응답을 주고 받으면 연결이 끊어진다
- 클라이언트가 다시 요청하면 서버는 이전 요청을 기억하지 못한다
- 클라이언트와 서버는 서로 상태를 유지하지 않는다

### 비 연결성(Connectionless)

- 요청과 응답이 끝난 후 클라이언트와 서버간 연결을 끊음으로써 자원을 낭비하지 않는다
- HTTP는 기본이 연결을 유지하지 않는 모델이다
- TCP/IP 연결을 새로 맺어야 한다 - 3 way handshake 시간이 추가된다
- 웹 브라우저로 사이트를 요청하면 HTML 뿐만 아니라 js,  css, 이미지 등 수 많은 자원이 함께 다운로드 된다
- 그래서 지금은 HTTP 지속 연결(Persistent Conections)로 문제를 해결한다

### HTTP 메시지

HTTP 메시지 구조

- start-line 시작 라인
- header 헤더
- empty line 공백 라인(CRLF)
- message body

시작 라인

- 요청 메시지 - HTTP 메서드, 요청 대상, HTTP 버전
  - ex) GET /search?q=hello HTTP/1.1
- 응답 메시지 - HTTP 버전, HTTP 상태 코드, 이유 문구
  - ex) HTTP/1.1 200 OK

HTTP 헤더

- HTTP 전송에 필요한 모든 부가정보

- filed-name ":" OWS field-value OWS (OWS: 띄어쓰기 허용)
  - ex) 요청 메시지: Host: www.google.com
  - ex) 응답 메시지: Content-Type: text/html;charset=UTF-8

HTTP 메시지 바디

- 실제 전송할 데이터

API URI 설계

- 리소스를 식별한 후 리소스(명사)와 행위(동사)를 분리하자
- 리소스: 회원
- 행위: 조회, 등록, 수정, 삭제
- 계층 구조상 상위를 컬렉션으로 보고 복수단어 사용을 권장한다(member -> members)

---

### HTTP 메서드

1. GET
   - 리소스 조회
   - 서버에 전달하고 싶은 데이터는 쿼리를 통하여 전달
   - 메시지 바디를 사용하여 데이터를 전달할 수는 있지만 권장하지 않는다

2. POST
   - 메시지 바디를 통해 서버로 요청 데이터를 전달하여 처리
   - 주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용된다
     - HTML 양식에 입력 된 필드와 같은 데이터 블록을 데이터 처리 프로세스에 제공
     - 서버가 아직 식별하지 않은 새 리소스 생성
     - 기존 리소스에 데이터 추가

3. PUT
   - 클라이언트가 리소스를 식별
   - 리소스가 없으면  생성
   - 리소스가 있으면 완전히 대체 (덮어쓰기)
     - ex) 기존에 name, age 두 필드가 있는 경우 age 필드만 요청하면 name 필드는 삭제된다

4. PATCH
   - 리소스 부분 변경

5. DELETE
   - 리소스 제거

### 기타 메서드

- HEAD: GET과 동일하지만 메시지 부분을 제외하고 상태 줄과 헤더만 반환
- OPTIONS: 대상 리소스에 대한 통신 가능 옵션(메서드)을 설명(주로 CORS에서 사용)
- CONNECT: 대상 리소스로 식별되는 서버에 대한 터널을 설정
- TRACE: 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행

### HTTP 메서드의 속성

- Safe 안전: 호출해도 리소스를 변경하지 않는다
- Idempotent 멱등: 동일한 요청을 한 번 보내는 것과 여러 번 연속으로 보내는 것이 같은 효과를 지니고 서버의 상태도 동일하게 남는 것 == 멱등성
  - GET: 한 번 조회, 여러 번 조회 모두 같은 결과가 조회된다
  - PUT: 결과를 대체한다, 같은 요청을 여러번 해도 최종 결과는 같다
  - DELETE: 결과를 삭제한다, 같은 요청을 여러번 해도 삭제된 결과는 똑같다
  - POST: 두 번 호출하면 같은 결제가 중복해서 발생할 수 있으므로 멱등이 아니다

- Cacheable 캐시가능: 응답 결과 리소스의 캐시 사용 가능
  - GET, HEAD, POST, PATCH 캐시가능, 실제로는 GET, HEAD 정도만 캐시로 사용
    - POST, PATCH는 본문 내용까지 캐시 키로 고려해야 하는데 구현이 쉽지 않다

---

### HTTP 상태코드

### 2xx (Successful): 요청 정상 처리

- 200 OK: 요청 성공
- 201 Created: 요청 성공해서 새로운 리소스가 생성됨
- 202 Accepted: 요청이 접수되었으나 처리가 완료되지 않음
- 204 No Content: 서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없음

### 3xx (Redirection): 요청을 완료하려면 추가 행동이 필요

- 영구 리다이렉션: 특정 리소스의 URI가 영구적으로 이동

  - 301 Moved Permanently: 리다이렉트시 요청 메서드가 GET으로 변하고 본문이 제거될 수 있음

  - 308 Permanent Redirect: 리다이렉트시 요청 메서드와 본문 유지(POST로 보내면 리다이렉트도 POST)

- 일시적인 리다이렉션: 리소스의 URI가 일시적으로 변경
  - 302 Found: 리다이렉트시 요청 메서드가 GET으로 변하고 본문이 제거될 수 있음
  - 303 See Other: 302와 기능은 같음, 리다이렉트시 요청 메서드가 GET으로 변경
  - 307 Temporary Redirect: 302와 기능은 같음, 리다이렉트시 요청 메서드와 본문 유지(요청 메서드를 변경하면 안됨)

- 일시적인 리다이렉션 예시 PRG: Post/Redirect/Get
  - POST로 주문후에 새로고침으로 인한 중복 주문 방지
  - POST로 주문후에 주문 결과 화면을 GET 메서드로 리다이렉트
  - 새로고침해도 결과 화면을 GET으로 조회 -> 중복 주문 대신 결과 화면만 GET으로 다시 요청

- 기타 리다이렉션
  - 304 Not Modified: 캐시를 목적으로 사용
    - 클라이언트에게 리소스가 수정되지 않았음을 알려준다, 로컬PC에 저장된 캐시를 재사용
    - 로컬 캐시를 사용해야 하므로 응답에 메시지 바디를 포함하면 안된다
    - 조건부 GET, HEAD 요청시 사용

### 4xx (Client Error): 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음

- 400 Bad Request: 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음
  - 요청 구문, 메시지 오류 등
  - 클라이언트는 요청 내용을 다시 검토하고 보내야함
  - ex) 요청 파라미터가 잘못되거나 API 스펙이 맞지 않을 때

- 401 Unauthorized: 클라이언트가 해당 리소스에 대한 인증이 필요함
  - 인증(Authentication) 되지 않음
  - 401 오류 발생 시 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명
  - 인증(Authentication): 본인이 누구인지 확인 (로그인)
  - 인가(Authorization): 권한부여 (ADMIN 권한처럼 특정 리소스에 접근할 수 있는 권한, 인증이 있어야 인가가 있다)

- 403 Forbidden: 서버가 요청을 이해했지만 승인을 거부함
  - 인증 자격 증명은 있지만 접근 권한이 불충분한 경우

- 404 Not Found: 요청 리소스를 찾을 수 없음
  - 요청 리소스가 서버에 없음 또는 클라이언트가 권한이 부족한 리소스에 접근할 때 해당 리소스를 숨기고 싶을 때

### 5xx (Server Error): 서버 오류, 서버가 정상 요청을 처리하지 못함

- 500 Internal Server Error: 서버 문제로 오류 발생
  - 서버 내부 문제로 오류 발생, 애매하면 500 오류다

- 503 Service Unavailable: 서비스 이용 불가
  - 서비스가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
  - Retry-After 헤더 필드로 얼마뒤에 복구되는지 보낼 수 있음